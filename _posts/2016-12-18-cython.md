---
layout: post
title: "hello cython"
description: "when python meets c"
date: 2016- 12-06
tags: [machine learning]
comments: false
share: true
---

hello cython!
---

cython menawarkan kecepatan dari c dan "kemudahan" dari python.
contoh kasus, dalam text retreival, untuk melihat kesamaan dari satu text dengan text lain, bisa dilakukan dengan dot product dari masing masing vektor.

permasalahan pertama, merubah teks dalam bentuk vektor.

misal, q dan d (dimana, q adalah query dan d adalah dokumen)

q = "kemarin paman datang"
d = "kemarin paman membawa setandan pisang"

untuk melihat kesamaan antara dua teks diatas, masing masing token perlu 
dirubah dalam bentuk vektor.

anggap a adalah dimensi dari vektor dari query (q) dan b adalah dimensi dari vektor dari dokumen (d), besar dimensi q < d. 

solusi masalah pertama:

```
def vsm3(w, x):
    a = []
    b = []

    
    for i in w.split():
        if i in x.split(): 
            a.append(1)
        else:
            a.append(0)

    for j in x.split():
        if j in w.split():
            b.append(1)
        else:
            b.append(0)
    
    if len(a) > len(b):
        tetha = len(a) - len(b)
        for i in range(tetha):
            lenb = len(b)
            b.insert(lenb, 0)
        return a, b
    
    elif len(a) < len(b):
        tetha = len(b) - len(a)
        for i in range(tetha):
            lena = len(a)
            a.insert(lena, 0)
        return a, b
        
    return a, b
    
```

fungsi diatas akan merubah query dan dokumen, dalam bentuk vektor.
dimana vektor tersebut terdiri dari 0, 1. bila token a dari q ada di d, +1, selain itu +0. begitu juga pada d.

```
In [25]: vsm3(q, d)
Out[25]: ([1, 1, 0, 0, 0], [1, 1, 0, 0, 0])

```

selanjutnya, menghitung dot product antara vektor dari q dan d.

```
In [29]: import numpy as np

In [30]: a, b = vsm3(q, d)

In [31]: np.dot(a,b)
Out[31]: 2
````

> semakin besar nilai dot product antara q dan d, bisa disimpulkan kalau q memiliki beberapa kesamaan dengan d. 

permasalahan berikutnya, kecepatan.

dengan menggunakan fungsi vms3 diatas, waktu yang diperlukan:

```
In [19]: %time vsm(q, d)
CPU times: user 58 µs, sys: 12 µs, total: 70 µs
Wall time: 58.9 µs
Out[19]: ([1, 1, 0, 0, 0], [1, 1, 0, 0, 0])
```

dengan menggunakan cython, bisa dipercepat lebih dari 10ms.
---

pertama, cython menggunakan ekstensi pyx dan perlu dilakukan compiling, ini bagian paling penting. karena cython akan melakukan penerjemahan dari python ke c.

```
from distutils.core import setup
from Cython.Build import cythonize

setup(
    name = "textr",
    ext_modules = cythonize('textr.pyx'),
)

```

run `python setup.py build_ext --inplace`
setelah melakukan build, bisa dilakukan benchmark, vsm=c dan vsm=python.

```
In [21]: from textr import vsm3 as vsm

In [22]: %time a, b = vsm3(q, d)
CPU times: user 66 µs, sys: 12 µs, total: 78 µs
Wall time: 63.2 µs

In [23]: %time a, b = vsm(q, d)
CPU times: user 36 µs, sys: 7 µs, total: 43 µs
Wall time: 51 µs

```
cython vsm
- cpu time user: 36 miliseconds

python vsm
- cpu time user: 66 miliseconds

i <3 cython!


